# 8장 트랜잭션

## 8.1 트랜잭션 소개

### 8.1.1 ACID

A: Atomicity 원자성: 부분적으로 적용될 수 없다.

C: Consistency 일관성: 트랜잭션이 성공하면 데이터베이스는 항상 일관적이다.

I: isolation 고립성: 여러 트랜잭션이 동시에 실행할 수 있다. 한 트랜잭션은 다른 트랜잭션의 부분 결과를 보지 않는다. 여러 병렬 트랜잭션이 각 트랜잭션을 순차적으로 실행할 때와 동일한 결과를 나타낸다.

D: Durability 영속성: 모든 데이터가 유지된다.

## 8.2트랜잭션 사용법

1.  코어 API 

오류 시 재시도 로직을 제공하지 않음. 개발자가 직접 작업, 커밋, 재시도 로직을 작성해야 함 

1. 콜백 API (권장)

논리 세션 시작, 재시도 로직등의 래핑된 함수제공 

1. 논리 세션 시작
2. 세션을 각 작업에 전달 
3. 논리세션은 전체 몽고디비 배포 컨텍스트에서 작업의 시간과 순서를 추적 

## 8.3 애플리케이션을 위한 트랜잭션 제한 조정

### 8.3.1 타이밍과 Oplog (Operation log)

1. 트랜잭션 시간 제한 : 트랜잭션이 실행될 수 있는 시간, 락 획득 대기 시간

기본 최대 실행 시간은 1분 이하. commitTransaction > maxTimeMS 

락 대기 최대 시간; 5ms. maxTrsnactionLockRequestTImeoutMillis 

1. 몽고디비 oplog항목과 크기 제한 

각 oplog는 chleo 16MB

- oplog: Operation Log. Replica Set Oplog. 내부에서 발생하는 모든 동작의 로그를 기록. 데이터의 변경을 처리할 수 있는 멤버는 Primary이며 Secondary는 문제가 발생했을 때 대타이므로 변경사항을 Oplog에 기록해서 나머지 멤버가 비동기적으로 데이터를 동기화할 수 있도록 한다.
    
    capped collection 에 저장이 되며 4.0부터는 용량을 초과해도 처리가 안되면 삭제되지 않는다.
